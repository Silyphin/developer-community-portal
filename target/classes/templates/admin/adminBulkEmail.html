<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Bulk Email - Community Portal</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/Header_n_Footer.css}">
    <!-- TinyMCE 7 -->
    <script src="https://cdn.tiny.cloud/1/ap0rn07686qs262tq020m1qvv9hxv81su2u8s72nu6jq1rq8/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
</head>
<body>
<!-- Navbar Fragment -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="text-center mb-4">Send Bulk Email Invitations</h1>

            <!-- Success/Error Messages -->
            <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${message}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <!-- Bulk Email Form -->
            <form th:action="@{/admin/send-bulk-email}" method="post" id="bulkEmailForm" onsubmit="return validateEmails()">
                <div class="mb-4">
                    <label for="emailFrom" class="form-label">From Email Address</label>
                    <input type="email" id="emailFrom" name="emailFrom" class="form-control"
                           th:value="${@environment.getProperty('app.mail.from')}" required
                           aria-describedby="emailFromHelp">
                    <div id="emailFromHelp" class="form-text">
                        Enter the email address that will appear as the sender.
                    </div>
                </div>

                <div class="mb-4">
                    <label for="emailAddresses" class="form-label">Email Addresses (one per line)</label>
                    <textarea id="emailAddresses" name="emailAddresses" rows="5" class="form-control"
                              placeholder="example1@example.com"
                              aria-describedby="emailAddressesHelp" required></textarea>
                    <div id="emailAddressesHelp" class="form-text">
                        Enter email addresses, one per line. Separate multiple addresses with a new line (Enter key).
                    </div>
                    <div id="emailError" class="invalid-feedback" style="display: none;">
                        Please ensure all email addresses are valid.
                    </div>
                </div>

                <div class="mb-4">
                    <label for="emailSubject" class="form-label">Email Subject</label>
                    <input type="text" id="emailSubject" name="emailSubject" class="form-control"
                           value="Invitation to Join Our Developer Community Portal" required
                           aria-describedby="emailSubjectHelp">
                    <div id="emailSubjectHelp" class="form-text">
                        Enter a clear and concise subject line for the email.
                    </div>
                </div>

                <div class="mb-4">
                    <label for="emailContent" class="form-label">Email Content</label>
                    <textarea id="emailContent" name="emailContent" class="form-control" required>Dear {First.Name},

We would like to invite you to join our Developer Community Portal, where you can connect with other software professionals, share knowledge, and explore job opportunities.

Your email: {Email}

To register, please visit: http://localhost:8080/register

Best regards,
The Community Portal Team</textarea>
                </div>

                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">Send Invitations</button>
                    <a th:href="@{/admin}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Footer Fragment -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<!-- Custom JS -->
<script th:src="@{/js/bulk_email_validation.js}"></script>
</body>
</html>